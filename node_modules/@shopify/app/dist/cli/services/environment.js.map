{"version":3,"file":"environment.js","sourceRoot":"","sources":["../../../src/cli/services/environment.ts"],"names":[],"mappings":"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","sourcesContent":["import {selectOrCreateApp} from './dev/select-app.js'\nimport {\n  fetchAllStores,\n  fetchAppFromApiKey,\n  fetchOrgAndApps,\n  fetchOrganizations,\n  fetchOrgFromId,\n  fetchStoreByDomain,\n  FetchResponse,\n  fetchAppExtensionRegistrations,\n} from './dev/fetch.js'\nimport {convertToTestStoreIfNeeded, selectStore} from './dev/select-store.js'\nimport {ensureDeploymentIdsPresence} from './environment/identifiers.js'\nimport {createExtension, ExtensionRegistration} from './dev/create-extension.js'\nimport {reuseDevConfigPrompt, selectOrganizationPrompt} from '../prompts/dev.js'\nimport {AppInterface} from '../models/app/app.js'\nimport {Identifiers, UuidOnlyIdentifiers, updateAppIdentifiers, getAppIdentifiers} from '../models/app/identifiers.js'\nimport {Organization, OrganizationApp, OrganizationStore} from '../models/organization.js'\nimport metadata from '../metadata.js'\nimport {ThemeExtension} from '../models/app/extensions.js'\nimport {error as kitError, output, session, store, ui, environment, error, string} from '@shopify/cli-kit'\nimport {PackageManager} from '@shopify/cli-kit/node/node-package-manager'\n\nexport const InvalidApiKeyError = (apiKey: string) => {\n  return new kitError.Abort(\n    output.content`Invalid API key: ${apiKey}`,\n    output.content`You can find the API key in the app settings in the Partners Dashboard.`,\n  )\n}\n\nexport const DeployAppNotFound = (apiKey: string, packageManager: PackageManager) => {\n  return new kitError.Abort(\n    output.content`Couldn't find the app with API key ${apiKey}`,\n    output.content`â€¢ If you didn't intend to select this app, run ${\n      output.content`${output.token.packagejsonScript(packageManager, 'deploy', '--reset')}`.value\n    }`,\n  )\n}\n\nexport const AppOrganizationNotFoundError = (apiKey: string, organizations: string[]) => {\n  return new kitError.Abort(\n    `The application with API Key ${apiKey} doesn't belong to any of your organizations: ${organizations.join(', ')}`,\n  )\n}\n\nconst OrganizationNotFoundError = (orgId: string) => {\n  return new error.Bug(`Could not find Organization for id ${orgId}.`)\n}\n\nconst StoreNotFoundError = async (storeName: string, org: Organization) => {\n  return new error.Bug(\n    `Could not find ${storeName} in the Organization ${org.businessName} as a valid development store.`,\n    `Visit https://${await environment.fqdn.partners()}/${org.id}/stores to create a new store in your organization`,\n  )\n}\n\nexport interface DevEnvironmentOptions {\n  app: AppInterface\n  apiKey?: string\n  storeFqdn?: string\n  reset: boolean\n}\n\ninterface DevEnvironmentOutput {\n  app: Omit<OrganizationApp, 'apiSecretKeys' | 'apiKey'> & {apiSecret?: string}\n  storeFqdn: string\n  identifiers: UuidOnlyIdentifiers\n  updateURLs: boolean | undefined\n  tunnelPlugin: string | undefined\n}\n\n/**\n * Make sure there is a valid environment to execute `dev`\n * That means we have a valid organization, app and dev store selected.\n *\n * If there are app/store from flags, we check if they are valid. If they are not, throw an error.\n * If there is cached info (user ran `dev` previously), check if it is still valid and return it.\n * If there is no cached info (or is invalid):\n *  - Show prompts to select an org, app and dev store\n *  - The new selection will be saved as global configuration\n *  - The `shopify.app.toml` file will be updated with the new app apiKey\n *\n * @param options - Current dev environment options\n * @returns The selected org, app and dev store\n */\nexport async function ensureDevEnvironment(\n  options: DevEnvironmentOptions,\n  token: string,\n): Promise<DevEnvironmentOutput> {\n  const prodEnvIdentifiers = await getAppIdentifiers({app: options.app})\n  const envExtensionsIds = prodEnvIdentifiers.extensions || {}\n\n  const cachedInfo = await getAppDevCachedInfo({\n    reset: options.reset,\n    directory: options.app.directory,\n  })\n\n  if (cachedInfo === undefined && !options.reset) {\n    const explanation =\n      `\\nLooks like this is the first time you're running dev for this project.\\n` +\n      'Configure your preferences by answering a few questions.\\n'\n    output.info(explanation)\n  }\n\n  const orgId = cachedInfo?.orgId || (await selectOrg(token))\n\n  let {app: selectedApp, store: selectedStore} = await fetchDevDataFromOptions(options, orgId, token)\n  if (selectedApp && selectedStore) {\n    // eslint-disable-next-line no-param-reassign\n    options = await updateDevOptions({...options, apiKey: selectedApp.apiKey})\n\n    await store.setAppInfo({\n      appId: selectedApp.apiKey,\n      directory: options.app.directory,\n      storeFqdn: selectedStore.shopDomain,\n      orgId,\n    })\n\n    // If the selected app is the \"prod\" one, we will use the real extension IDs for `dev`\n    const extensions = prodEnvIdentifiers.app === selectedApp.apiKey ? envExtensionsIds : {}\n    return {\n      app: {\n        ...selectedApp,\n        apiSecret: selectedApp.apiSecretKeys.length === 0 ? undefined : selectedApp.apiSecretKeys[0]!.secret,\n      },\n      storeFqdn: selectedStore.shopDomain,\n      identifiers: {\n        app: selectedApp.apiKey,\n        extensions,\n      },\n      updateURLs: cachedInfo?.updateURLs,\n      tunnelPlugin: cachedInfo?.tunnelPlugin,\n    }\n  }\n\n  const {organization, apps} = await fetchOrgAndApps(orgId, token)\n  selectedApp = selectedApp || (await selectOrCreateApp(options.app, apps, organization, token, cachedInfo?.appId))\n  await store.setAppInfo({\n    appId: selectedApp.apiKey,\n    title: selectedApp.title,\n    directory: options.app.directory,\n    orgId,\n  })\n\n  // eslint-disable-next-line no-param-reassign\n  options = await updateDevOptions({...options, apiKey: selectedApp.apiKey})\n  if (!selectedStore) {\n    const allStores = await fetchAllStores(orgId, token)\n    selectedStore = await selectStore(allStores, organization, token, cachedInfo?.storeFqdn)\n  }\n\n  await store.setAppInfo({\n    appId: selectedApp.apiKey,\n    directory: options.app.directory,\n    storeFqdn: selectedStore?.shopDomain,\n  })\n\n  if (selectedApp.apiKey === cachedInfo?.appId && selectedStore.shopDomain === cachedInfo.storeFqdn) {\n    showReusedValues(organization.businessName, cachedInfo, options.app.packageManager)\n  }\n\n  const extensions = prodEnvIdentifiers.app === selectedApp.apiKey ? envExtensionsIds : {}\n  const result = {\n    app: {\n      ...selectedApp,\n      apiSecret: selectedApp.apiSecretKeys.length === 0 ? undefined : selectedApp.apiSecretKeys[0]!.secret,\n    },\n    storeFqdn: selectedStore.shopDomain,\n    identifiers: {\n      app: selectedApp.apiKey,\n      extensions,\n    },\n    updateURLs: cachedInfo?.updateURLs,\n    tunnelPlugin: cachedInfo?.tunnelPlugin,\n  }\n  await logMetadataForLoadedDevEnvironment(result)\n  return result\n}\n\nasync function updateDevOptions(options: DevEnvironmentOptions & {apiKey: string}) {\n  const updatedApp = await updateAppIdentifiers({\n    app: options.app,\n    identifiers: {\n      app: options.apiKey,\n      extensions: {},\n    },\n    command: 'dev',\n  })\n  return {\n    ...options,\n    app: updatedApp,\n  }\n}\n\nexport interface DeployEnvironmentOptions {\n  app: AppInterface\n  apiKey?: string\n  reset: boolean\n}\n\ninterface DeployEnvironmentOutput {\n  app: AppInterface\n  token: string\n  partnersOrganizationId: string\n  partnersApp: Omit<OrganizationApp, 'apiSecretKeys' | 'apiKey'>\n  identifiers: Identifiers\n}\n\n/**\n * If there is a cached ApiKey used for dev, retrieve that and ask the user if they want to reuse it\n * @param app - The local app object\n * @param token - The token to use to access the Partners API\n * @returns\n * OrganizationApp if a cached value is valid.\n * undefined if there is no cached value or the user doesn't want to use it.\n */\nexport async function fetchDevAppAndPrompt(app: AppInterface, token: string): Promise<OrganizationApp | undefined> {\n  const devAppId = (await store.getAppInfo(app.directory))?.appId\n  if (!devAppId) return undefined\n\n  const partnersResponse = await fetchAppFromApiKey(devAppId, token)\n  if (!partnersResponse) return undefined\n\n  const org: Organization | undefined = await fetchOrgFromId(partnersResponse.organizationId, token)\n\n  showDevValues(org?.businessName ?? 'unknown', partnersResponse.title)\n  const reuse = await reuseDevConfigPrompt()\n  return reuse ? partnersResponse : undefined\n}\n\nexport async function ensureThemeExtensionDevEnvironment(\n  extension: ThemeExtension,\n  apiKey: string,\n  token: string,\n): Promise<ExtensionRegistration> {\n  const remoteSpecifications = await fetchAppExtensionRegistrations({token, apiKey})\n  const remoteRegistrations = remoteSpecifications.app.extensionRegistrations.filter((extension) => {\n    return extension.type === 'THEME_APP_EXTENSION'\n  })\n\n  if (remoteRegistrations.length > 0) {\n    return remoteRegistrations[0]!\n  }\n\n  const registration = await createExtension(apiKey, extension.type, extension.localIdentifier, token)\n\n  return registration\n}\n\nexport async function ensureDeployEnvironment(options: DeployEnvironmentOptions): Promise<DeployEnvironmentOutput> {\n  const token = await session.ensureAuthenticatedPartners()\n  const [partnersApp, envIdentifiers] = await fetchAppAndIdentifiers(options, token)\n\n  let identifiers: Identifiers = envIdentifiers as Identifiers\n\n  identifiers = await ensureDeploymentIdsPresence({\n    app: options.app,\n    appId: partnersApp.apiKey,\n    appName: partnersApp.title,\n    token,\n    envIdentifiers,\n  })\n\n  // eslint-disable-next-line no-param-reassign\n  options = {\n    ...options,\n    app: await updateAppIdentifiers({app: options.app, identifiers, command: 'deploy'}),\n  }\n  const result = {\n    app: options.app,\n    partnersApp: {\n      id: partnersApp.id,\n      title: partnersApp.title,\n      appType: partnersApp.appType,\n      organizationId: partnersApp.organizationId,\n      grantedScopes: partnersApp.grantedScopes,\n    },\n    partnersOrganizationId: partnersApp.organizationId,\n    identifiers,\n    token,\n  }\n\n  await logMetadataForLoadedDeployEnvironment(result)\n  return result\n}\n\nexport async function fetchOrganizationAndFetchOrCreateApp(\n  app: AppInterface,\n  token: string,\n): Promise<{partnersApp: OrganizationApp; orgId: string}> {\n  const orgId = await selectOrg(token)\n  const {organization, apps} = await fetchOrgsAppsAndStores(orgId, token)\n  const partnersApp = await selectOrCreateApp(app, apps, organization, token, undefined)\n  return {orgId, partnersApp}\n}\n\nasync function fetchAppAndIdentifiers(\n  options: {app: AppInterface; reset: boolean; packageManager?: PackageManager; apiKey?: string},\n  token: string,\n): Promise<[OrganizationApp, Partial<UuidOnlyIdentifiers>]> {\n  let envIdentifiers = await getAppIdentifiers({app: options.app})\n\n  let partnersApp: OrganizationApp | undefined\n\n  if (options.reset) {\n    envIdentifiers = {app: undefined, extensions: {}}\n  } else if (envIdentifiers.app) {\n    const apiKey = options.apiKey ?? envIdentifiers.app\n    partnersApp = await fetchAppFromApiKey(apiKey, token)\n    if (!partnersApp) throw DeployAppNotFound(apiKey, options.app.packageManager)\n  } else {\n    partnersApp = await fetchDevAppAndPrompt(options.app, token)\n  }\n\n  if (!partnersApp) {\n    const result = await fetchOrganizationAndFetchOrCreateApp(options.app, token)\n    partnersApp = result.partnersApp\n  }\n\n  return [partnersApp, envIdentifiers]\n}\n\nasync function fetchOrgsAppsAndStores(orgId: string, token: string): Promise<FetchResponse> {\n  let data = {} as FetchResponse\n  const list = ui.newListr(\n    [\n      {\n        title: 'Fetching organization data',\n        task: async () => {\n          const organizationAndApps = await fetchOrgAndApps(orgId, token)\n          const stores = await fetchAllStores(orgId, token)\n          data = {...organizationAndApps, stores} as FetchResponse\n          // We need ALL stores so we can validate the selected one.\n          // This is a temporary workaround until we have an endpoint to fetch only 1 store to validate.\n        },\n      },\n    ],\n    {rendererSilent: environment.local.isUnitTest()},\n  )\n  await list.run()\n  return data\n}\n\n/**\n * Any data sent via input flags takes precedence and needs to be validated.\n * If any of the inputs is invalid, we must throw an error and stop the execution.\n */\nasync function fetchDevDataFromOptions(\n  options: DevEnvironmentOptions,\n  orgId: string,\n  token: string,\n): Promise<{app?: OrganizationApp; store?: OrganizationStore}> {\n  let selectedApp: OrganizationApp | undefined\n  let selectedStore: OrganizationStore | undefined\n\n  if (options.apiKey) {\n    selectedApp = await fetchAppFromApiKey(options.apiKey, token)\n    if (!selectedApp) throw InvalidApiKeyError(options.apiKey)\n  }\n\n  if (options.storeFqdn) {\n    const orgWithStore = await fetchStoreByDomain(orgId, token, options.storeFqdn)\n    if (!orgWithStore) throw OrganizationNotFoundError(orgId)\n    if (!orgWithStore.store) throw await StoreNotFoundError(options.storeFqdn, orgWithStore?.organization)\n    await convertToTestStoreIfNeeded(orgWithStore.store, orgWithStore.organization, token)\n    selectedStore = orgWithStore.store\n  }\n\n  return {app: selectedApp, store: selectedStore}\n}\n\n/**\n * Retrieve cached info from the global configuration based on the current local app\n * @param reset - Whether to reset the cache or not\n * @param directory - The directory containing the app.\n */\nasync function getAppDevCachedInfo({\n  reset,\n  directory,\n}: {\n  reset: boolean\n  directory: string\n}): Promise<store.CachedAppInfo | undefined> {\n  if (reset) await store.clearAppInfo(directory)\n  return store.getAppInfo(directory)\n}\n\n/**\n * Fetch all orgs the user belongs to and show a prompt to select one of them\n * @param token - Token to access partners API\n * @returns The selected organization ID\n */\nasync function selectOrg(token: string): Promise<string> {\n  const orgs = await fetchOrganizations(token)\n  const org = await selectOrganizationPrompt(orgs)\n  return org.id\n}\n\n/**\n * Message shown to the user in case we are reusing a previous configuration\n * @param org - Organization name\n * @param app - App name\n * @param store - Store domain\n */\nfunction showReusedValues(org: string, cachedAppInfo: store.CachedAppInfo, packageManager: PackageManager): void {\n  let updateURLs = 'Not yet configured'\n  if (cachedAppInfo.updateURLs !== undefined) updateURLs = cachedAppInfo.updateURLs ? 'Always' : 'Never'\n\n  output.info('\\nUsing your previous dev settings:')\n  output.info(`- Org:          ${org}`)\n  output.info(`- App:          ${cachedAppInfo.title}`)\n  output.info(`- Dev store:    ${cachedAppInfo.storeFqdn}`)\n  output.info(`- Update URLs:  ${updateURLs}`)\n  if (cachedAppInfo.tunnelPlugin) {\n    output.info(`- Tunnel:       ${cachedAppInfo.tunnelPlugin}`)\n  }\n  output.info(\n    output.content`\\nTo reset your default dev config, run ${output.token.packagejsonScript(\n      packageManager,\n      'dev',\n      '--reset',\n    )}\\n`,\n  )\n}\n\n/**\n * Message shown to the user in case we are reusing a previous configuration\n * @param org - Organization name\n * @param app - App name\n * @param store - Store domain\n */\nfunction showDevValues(org: string, appName: string) {\n  output.info('\\nYour configs for dev were:')\n  output.info(`Org:        ${org}`)\n  output.info(`App:        ${appName}\\n`)\n}\n\nasync function logMetadataForLoadedDevEnvironment(env: DevEnvironmentOutput) {\n  await metadata.addPublic(() => ({\n    partner_id: string.tryParseInt(env.app.organizationId),\n    api_key: env.identifiers.app,\n  }))\n}\n\nasync function logMetadataForLoadedDeployEnvironment(env: DeployEnvironmentOutput) {\n  await metadata.addPublic(() => ({\n    partner_id: string.tryParseInt(env.partnersOrganizationId),\n    api_key: env.identifiers.app,\n  }))\n}\n"]}