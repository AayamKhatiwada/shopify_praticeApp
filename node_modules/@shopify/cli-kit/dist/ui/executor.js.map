{"version":3,"file":"executor.js","sourceRoot":"","sources":["../../src/ui/executor.ts"],"names":[],"mappings":"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","sourcesContent":["import {CustomInput} from './inquirer/input.js'\nimport {CustomAutocomplete} from './inquirer/autocomplete.js'\nimport {CustomSelect} from './inquirer/select.js'\nimport {CustomPassword} from './inquirer/password.js'\nimport {Question, QuestionChoiceType} from '../ui.js'\nimport inquirer, {Answers, QuestionCollection} from 'inquirer'\nimport fuzzy from 'fuzzy'\n\nexport async function run<\n  TName extends string & keyof TAnswers,\n  TAnswers extends {[key in TName]: string} = {[key in TName]: string},\n>(question: unknown): Promise<TAnswers> {\n  const questionName = (question as Question).name\n  return (await inquirer.prompt(question as QuestionCollection<Answers>, {...(question as Question).choices}))[\n    questionName\n  ]\n}\n\nexport function mapper(question: Question): unknown {\n  switch (question.type) {\n    case 'input':\n      inquirer.registerPrompt('custom-input', CustomInput)\n      return {\n        ...question,\n        type: 'custom-input',\n      }\n    case 'password':\n      inquirer.registerPrompt('custom-password', CustomPassword)\n      return {\n        ...question,\n        type: 'custom-password',\n      }\n    case 'select':\n      inquirer.registerPrompt('custom-select', CustomSelect)\n      return {\n        ...question,\n        type: 'custom-select',\n        source: getAutompleteFilterType(),\n        choices: question.choices ? groupAndMapChoices(question.choices) : undefined,\n      }\n    case 'autocomplete':\n      inquirer.registerPrompt('autocomplete', CustomAutocomplete)\n      return {\n        ...question,\n        type: 'autocomplete',\n        source: getAutompleteFilterType(),\n      }\n  }\n}\n\nfunction fuzzyFilter(answers: {name: string; value: string}[], input = '') {\n  return new Promise((resolve) => {\n    resolve(\n      fuzzy\n        .filter(input, Object.values(answers), {\n          extract(el: {name: string; value: string}) {\n            return el.name\n          },\n        })\n        .map((el) => el.original),\n    )\n  })\n}\n\nfunction containsFilter(answers: {name: string; value: string}[], input = '') {\n  return new Promise((resolve) => {\n    resolve(Object.values(answers).filter((answer) => !answer.name || answer.name.includes(input)))\n  })\n}\n\nfunction getAutompleteFilterType() {\n  return process.env.SHOPIFY_USE_AUTOCOMPLETE_FILTER === 'fuzzy' ? fuzzyFilter : containsFilter\n}\n\nexport function groupAndMapChoices(choices: QuestionChoiceType[]) {\n  const initialGroups: {name?: string; order: number; choices: {name: string; value: string; order?: number}[]}[] = []\n\n  // Switched from choices with group information to groups with a list of choices\n  const groups = choices.reduce((finalChoices, choice) => {\n    const currentGroup = choice.group ?? {name: 'Other', order: Number.MAX_SAFE_INTEGER}\n    const existingGroup = finalChoices.find((group) => group.name === currentGroup.name)\n    if (existingGroup) {\n      existingGroup.choices.push(choice)\n    } else {\n      finalChoices.push({...currentGroup, choices: [choice]})\n    }\n    return finalChoices\n  }, initialGroups)\n\n  const sortedGroups = groups.sort((g1, g2) => g1.order - g2.order)\n  const grouped = sortedGroups.length > 1 || sortedGroups[0]!.order !== Number.MAX_SAFE_INTEGER\n\n  // Mapped the group with a list of extensions to a list of inquirer choices including group separators\n  return sortedGroups.flatMap((group) => {\n    const finalChoices: ({type: string; line: string} | {name: string; value: string})[] = []\n    if (grouped && group.name) {\n      finalChoices.push({type: 'separator', line: ''})\n      finalChoices.push({type: 'separator', line: group.name})\n    }\n    finalChoices.push(...group.choices)\n    return finalChoices\n  })\n}\n"]}